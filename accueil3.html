
<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="style.css"/> <!--mise en forme-->
	<title>MyTitle</title> <!-- onglet -->
</head>

<header>
	<div class="intro">
	Repartition frais de ..
	</div>
</header>

<body>

	<div class="intro">
		Ajouter une personne : <input id="name" type="text" name="name" value="nom"> <!-- textfield -->
		<input type="button" name="addLineTab" value="Ajouter personne" onclick="addPersonne()">
		<input type="button" name="start_reset" value="Start/Reset" onclick="start_reset()">
	</div>

	<div>
		<input type="button" name="addRow" value="ajouter une nouvelle ligne" onclick="addRow()">
		<! <input type="button" name="addRow" value="affiche start" onclick="afficheStart()">
		</br></br>
	</div>

	<TABLE id="tab" BORDER="1"> 
		<CAPTION> Tableau de dépenses </CAPTION> 
		<THEAD>
			<TR> 
			 <TH> Depense de </TH> 
			 <TH> Montant </TH> 
			</TR>
		</THEAD>
		<TBODY>
			
			
		</TBODY>
	</TABLE> 


	
	<div>	
		</br></br>
		<input type="button" name="finish" value="finish => decompte!" onclick="finish()">
		<input type="button" name="parcoursTab" value="parcours Tab" onclick="parcoursTab()">
		<input type="button" name="deleteDuplicate" value="deleteDuplicate" onclick="deleteDuplicate()">
	</div>
	<div>	
		</br></br>
		<input type="button" name="afficheResults" value="SHOW RESULTS" onclick="afficheResults()">
	</div>

</body>

<!-- -------------------------------------------------------------------------------------------->
<script>

var tab=[];   // initialise;
var isStarted = false;
var tabResult=[];
var theRowNumber = 1;
var tabCouple = [];
var newTabCouple = [];


function finish(){
	alert("ahah !! tu n'as quand mm pas cru que j'avais aussi fait les calculs ^^");
}

function afficheStart(){
	alert(isStarted);
}
function start_reset(){
	if (!isStarted){
		isStarted = true;
		addRow();
	}
	else{
		window.location = "accueil3.html";//"file:///home/entdev3/Documents/GIT/web/accueil3.html"
	}

}
function addRow(){
	
	if (isStarted){
		var newRow = document.getElementById("tab").insertRow(-1);

		// Add Select
		var cell0 = newRow.insertCell(0);
		cell0.innerHTML += createTextSelect(theRowNumber);

		//Add Input Amount
		var cell1 = newRow.insertCell(1);
		var id = theRowNumber + "1";
		cell1.innerHTML = '<input id="'+id+'" type="text" value="00.00">';

		// Add checkbox for persons
		for(i=0; i<tab.length; i++){
			id = theRowNumber + (i+2).toString();
			var cell = newRow.insertCell(i+2);
			cell.innerHTML = '<input id="'+id+'" type="checkbox" >';
		}
		theRowNumber++;
	}
	else{
		alert("veuillez cliquer demarrer l'appli 'start/reset' avant d'ajouter des lignes");
	}
}
function createTextSelect(rowNumber){

	//'<select name="pays" id="pays"><option value="emiel">emiel</option><option value="kirsty">kirsty</option></select>'
	var nameSelect = 'select'+rowNumber;
	var id = rowNumber + "0";
	var text = '<select id="'+id+'" name="'+nameSelect+'" id="'+nameSelect+'">';
	for(i=0; i<tab.length; i++){
		text += '<option value="'+i+'">'+tab[i]+'</option>';
	}
	text += '</select>';
	return text;
}

function addPersonne(){
	if (!isStarted){
		var nameAdd = document.getElementById("name").value;
		ajoutTab(nameAdd);

		var arrayLines = document.getElementById("tab").rows;
		var cell = arrayLines[0].insertCell(-1);
	 /*	var table = document.getElementById ("tab");
		var firstRow = table.rows[0];
		var cell = firstRow.insertCell (1); */

		cell.innerHTML += "<b>"+nameAdd+"</b>";
	}
	else{
		alert("il n'est plus possible d'ajouter des prenom, veuillez cliquez sur reset et ajouter tout le monde avant de commencer!")
	}
}


function ajoutTab(name){
	tab.push(name);
}


/* construit tous les couples dans tabCouple */
function parcoursTab(){ 
	tabCouple = [];
	/*
	var tab = document.getElementById("tab");
	var tags = tab.getElementsByTagName("input");
	alert("mon premier tag : "+tags[0].innerHTML);
	*/
	
	var arrayLignes = document.getElementById("tab").rows; //on récupère les lignes du tableau
	var longueur = arrayLignes.length;//on peut donc appliquer la propriété length


	for(var i=1; i<longueur; i++){//on peut directement définir la variable i dans la boucle

		var largeur = arrayLignes[i].cells.length; // arrayColonnes.length;
		
		var idBuyer = document.getElementById(i.toString()+"0").value;
		var amount = parseFloat(document.getElementById(i.toString()+"1").value);
		var tabBeneficiary = [];

		for(var j=2; j<largeur; j++){
			var element = document.getElementById(i.toString()+j.toString());
    			if(element.checked == true){
				tabBeneficiary.push(j-2);
			}
		}
		var amountPerson = amount/tabBeneficiary.length; //float

		for(var k=0; k<tabBeneficiary.length; k++){
			if(idBuyer != tabBeneficiary[k]){
				var unCouple = [idBuyer,amountPerson,tabBeneficiary[k]];
				tabCouple.push(unCouple);
			}
		}
	}
	//alert("tabCouple : "+tabCouple[0]);
	afficheTabCouple(tabCouple);
}

function afficheTabCouple(tab){
	var txt = "";
	for(var i=0; i<tab.length; i++){
		txt += tab[i] + "\n";
	}
	alert(txt);
}
function deleteDuplicate(){
	for(var i=0; i<tabCouple.length; i++){
		var idBuyer = tabCouple[i][0];
		var amount = tabCouple[i][1];
		var idBenef = tabCouple[i][2];
		var alreadySeen = false;

		for(var k=0; k<newTabCouple.length; k++){
			if((idBuyer == newTabCouple[k][0]) && (idBenef == newTabCouple[k][2])){
				alreadySeen = true;
			}
			if((idBuyer == newTabCouple[k][2]) && (idBenef == newTabCouple[k][0])){
				alreadySeen = true;
			}
		}
		if(!alreadySeen){
			for(var j=i+1; j<tabCouple.length; j++){
			
				if((idBuyer == tabCouple[j][0]) && (idBenef == tabCouple[j][2])){ //on a un doublon
					amount += tabCouple[j][1];
				}
				if((idBuyer == tabCouple[j][2]) && (idBenef == tabCouple[j][0])){ //on a un doublon
					amount -= tabCouple[j][1];
				}
			}
			
			if(amount < 0){ 
				amount = amount*(-1); 
				var x = idBuyer;
				idBuyer = idBenef;
				idBenef = x;
			}
			var newCouple = [idBuyer,amount,idBenef];
			newTabCouple.push(newCouple);
		}
		
	}
	afficheTabCouple(newTabCouple);
}
function afficheResults(){
	var text = '';
	for(var k=0; k<newTabCouple.length; k++){
		text += tab[newTabCouple[k][2]] + "owes : " + newTabCouple[k][1] + "€ to "+ tab[newTabCouple[k][0]] + "\n";
	}
	alert(text);

}





</script>

</html>
